<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bakes-Villa â€” Cakes</title>

  <!-- Tailwind CDN (for a single-file workflow) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts (heading + body) -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bv-brown: #b0854b;
      --bv-dark: #2b2b2b;
      --bv-cream: #f7f4f1;
    }
    body { font-family: 'Lato', sans-serif; background: var(--bv-cream); -webkit-font-smoothing:antialiased; }
    .header-script { font-family: 'Pacifico', cursive; }
    .card-shadow { box-shadow: 0 8px 20px rgba(43,43,43,0.08); }
    /* small helpers for mobile sticky header spacing */
    .top-pad { padding-top: 72px; }
    /* admin badge */
    .pill { padding: .25rem .6rem; border-radius: 9999px; font-size: .75rem; }
  </style>
</head>
<body class="antialiased">

  <!-- CONFIG: Replace these values with your Supabase details -->
  <script>
    // --- EDIT THESE BEFORE DEPLOYING ---
    const SUPABASE_URL = 'REPLACE_WITH_YOUR_SUPABASE_URL';
    const SUPABASE_ANON_KEY = 'REPLACE_WITH_YOUR_SUPABASE_ANON_KEY';
    // If your table name contains a hyphen like Bakes-Villa, set:
    // const TABLE_NAME = '"Bakes-Villa"';
    // Otherwise set the plain table name:
    const TABLE_NAME = 'cakes';
    // Staff credentials (as you requested)
    const STAFF_USERNAME = 'siddhijain';
    const STAFF_PASSWORD = 'siddhijain12';
    // WhatsApp number in international format (no plus sign)
    const WHATSAPP_NUMBER = '917543060400';
  </script>

  <!-- Supabase JS SDK (from CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <!-- ===== Header / Navbar ===== -->
  <header class="fixed w-full top-0 left-0 z-40 bg-white/90 backdrop-blur-sm border-b">
    <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="text-2xl header-script text-[color:var(--bv-brown)]">Bakes-Villa</div>
        <nav class="hidden sm:flex gap-6 text-sm text-gray-700">
          <a href="#home" class="hover:underline">Home</a>
          <a href="#collection" class="hover:underline">Collection</a>
          <a href="#contact" class="hover:underline">Contact</a>
        </nav>
      </div>
      <div class="flex items-center gap-3">
        <button id="staffBtn" class="px-3 py-1 rounded-full bg-[color:var(--bv-dark)] text-white text-sm">Staff Login</button>
      </div>
    </div>
  </header>

  <!-- Content container with top padding so header doesn't overlap -->
  <main class="top-pad">

    <!-- HERO -->
    <section id="home" class="pt-8 pb-10">
      <div class="max-w-4xl mx-auto px-4 text-center">
        <h1 class="text-4xl sm:text-5xl header-script text-[color:var(--bv-dark)] leading-tight">Excellence Baked Daily</h1>
        <p class="mt-3 text-gray-600">Handcrafted cakes & pastries made with love. Order easily via WhatsApp.</p>
        <div class="mt-6 flex justify-center">
          <a href="#collection" class="px-6 py-3 rounded-full bg-[color:var(--bv-brown)] text-white header-script shadow-lg">Explore Collection</a>
        </div>
        <div class="mt-8">
          <div class="rounded-xl overflow-hidden border-2 border-[color:var(--bv-brown)] card-shadow mx-auto" style="max-width:720px">
            <img src="/images/hero.jpg" alt="Bakes-Villa hero image" class="w-full h-auto object-cover">
          </div>
        </div>
      </div>
    </section>

    <!-- COLLECTION -->
    <section id="collection" class="py-8">
      <div class="max-w-4xl mx-auto px-4">
        <div class="flex items-center justify-between">
          <h2 class="text-2xl header-script text-[color:var(--bv-brown)]">Collection</h2>
          <div id="adminIndicator" class="hidden items-center gap-2">
            <span class="pill bg-[color:var(--bv-brown)] text-white">Admin</span>
            <button id="logoutBtn" class="text-sm text-red-600">Logout</button>
          </div>
        </div>

        <div id="cakesGrid" class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-6">
          <!-- cake cards injected here -->
        </div>

        <div class="mt-6 text-center text-gray-500 text-sm body-sans">
          Tip: Use the Staff Login button to add or remove cakes (mobile-friendly).
        </div>
      </div>
    </section>

    <!-- CONTACT/FOOTER -->
    <footer id="contact" class="py-8 border-t mt-8">
      <div class="max-w-4xl mx-auto px-4 text-center">
        <h3 class="text-xl header-script text-[color:var(--bv-brown)]">Contact</h3>
        <p class="mt-3 text-gray-600">Email: <a href="mailto:bakesvillaindia@gmail.com" class="text-[color:var(--bv-dark)] hover:underline">bakesvillaindia@gmail.com</a><br>Phone: <a href="tel:+917543060400" class="text-[color:var(--bv-dark)] hover:underline">+91 75430 60400</a></p>
        <p class="mt-4 text-sm text-gray-500">Made for Bakes-Villa â€¢ Host-ready single file</p>
      </div>
    </footer>

  </main>

  <!-- ===== Staff Modal (hidden by default) ===== -->
  <div id="staffModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/40 p-4">
    <div class="bg-white w-full max-w-md rounded-xl overflow-hidden">
      <div class="p-4 border-b flex items-center justify-between">
        <div class="font-semibold">Staff Panel</div>
        <button id="closeModal" class="text-gray-500">Close</button>
      </div>

      <div class="p-4">
        <!-- If not logged in, show login form -->
        <div id="loginForm">
          <div class="mb-2 text-sm text-gray-600">Login as staff to add/delete cakes</div>
          <form id="login" class="grid gap-2">
            <input id="loginUser" placeholder="Username" class="border p-2 rounded" value="siddhijain">
            <input id="loginPass" placeholder="Password" class="border p-2 rounded" value="siddhijain12" type="password">
            <div class="flex gap-2">
              <button type="submit" class="flex-1 px-4 py-2 rounded bg-[color:var(--bv-brown)] text-white">Login</button>
              <button type="button" id="closeModal2" class="px-4 py-2 rounded border">Cancel</button>
            </div>
            <div id="loginMsg" class="text-sm text-red-500 mt-2 hidden"></div>
          </form>
        </div>

        <!-- Admin controls (shown after login) -->
        <div id="adminPanel" class="hidden">
          <div class="text-sm text-gray-600 mb-2">Add a new cake (image URL recommended)</div>
          <form id="addCakeForm" class="grid gap-2">
            <input id="cakeName" placeholder="Name" class="border p-2 rounded" required>
            <textarea id="cakeDesc" placeholder="Description" class="border p-2 rounded" rows="2"></textarea>
            <input id="cakePrice" placeholder="Price (e.g. 499)" class="border p-2 rounded" required inputmode="numeric">
            <input id="cakeImage" placeholder="Image URL (imageData)" class="border p-2 rounded">
            <div class="flex gap-2">
              <button type="submit" class="flex-1 px-4 py-2 rounded bg-green-600 text-white">Add Cake</button>
              <button type="button" id="refreshBtn" class="px-4 py-2 rounded border">Refresh</button>
            </div>
            <div id="adminMsg" class="text-sm text-green-600 mt-2 hidden"></div>
          </form>

          <div class="mt-4">
            <div class="text-sm text-gray-600 mb-2">Existing cakes</div>
            <div id="adminList" class="space-y-2 max-h-48 overflow-auto"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ===== Scripts ===== -->
  <script>
    // Basic safety checks: ensure supabase keys are set
    if (!SUPABASE_URL || SUPABASE_URL.includes('REPLACE') || !SUPABASE_ANON_KEY || SUPABASE_ANON_KEY.includes('REPLACE')) {
      console.warn('Supabase URL or ANON KEY not set â€” please fill the top config in the HTML.');
      // We'll still set up a non-working client to avoid runtime errors, but prompt the user.
    }

    // Initialize Supabase client
    const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Elements
    const cakesGrid = document.getElementById('cakesGrid');
    const staffBtn = document.getElementById('staffBtn');
    const staffModal = document.getElementById('staffModal');
    const closeModal = document.getElementById('closeModal');
    const closeModal2 = document.getElementById('closeModal2');
    const loginForm = document.getElementById('loginForm');
    const adminPanel = document.getElementById('adminPanel');
    const login = document.getElementById('login');
    const loginMsg = document.getElementById('loginMsg');
    const adminIndicator = document.getElementById('adminIndicator');
    const logoutBtn = document.getElementById('logoutBtn');
    const addCakeForm = document.getElementById('addCakeForm');
    const adminList = document.getElementById('adminList');
    const adminMsg = document.getElementById('adminMsg');
    const refreshBtn = document.getElementById('refreshBtn');

    let isAdmin = false;
    // Minimal client-side "session"
    function setAdmin(flag) {
      isAdmin = !!flag;
      adminIndicator.style.display = isAdmin ? 'flex' : 'none';
      loginForm.style.display = isAdmin ? 'none' : 'block';
      adminPanel.style.display = isAdmin ? 'block' : 'none';
      if(isAdmin) { loginMsg.classList.add('hidden'); }
    }

    // Modal toggles
    staffBtn.addEventListener('click', ()=> staffModal.classList.remove('hidden'));
    closeModal.addEventListener('click', ()=> staffModal.classList.add('hidden'));
    closeModal2.addEventListener('click', ()=> staffModal.classList.add('hidden'));

    // Logout
    logoutBtn.addEventListener('click', () => {
      setAdmin(false);
      staffModal.classList.add('hidden');
    });

    // Fetch cakes from Supabase
    async function fetchCakes(){
      try {
        // If TABLE_NAME uses a hyphen wrapped in quotes, we pass it directly.
        const tableName = TABLE_NAME;
        const { data, error } = await supabase.from(tableName).select('*').order('createdAt', { ascending: false });
        if (error) { console.error('Supabase fetch error', error); return []; }
        return data || [];
      } catch (err) {
        console.error('FetchCakes error', err);
        return [];
      }
    }

    // Render cake cards
    function renderCakes(cakes){
      cakesGrid.innerHTML = '';
      if (!cakes || cakes.length === 0) {
        cakesGrid.innerHTML = '<div class="text-center text-gray-500 col-span-full">No cakes found.</div>';
        return;
      }
      cakes.forEach(c => {
        // imageData may be a URL or base64. If empty fallback to placeholder
        const imgSrc = c.imageData || '/images/hero2.jpg' || 'https://images.unsplash.com/photo-1542831371-d531d36971e6';
        // price formatting
        const price = c.price ? `â‚¹${c.price}` : 'â‚¹0';
        const cakeName = c.name || 'Untitled';

        const card = document.createElement('div');
        card.className = 'bg-white rounded-xl p-3 card-shadow';

        card.innerHTML = `
          <div class="rounded-md overflow-hidden">
            <img src="${escapeHtml(imgSrc)}" alt="${escapeHtml(cakeName)}" class="w-full h-44 object-cover">
          </div>
          <h3 class="mt-3 header-script text-lg">${escapeHtml(cakeName)}</h3>
          <p class="mt-1 text-sm text-gray-600">${escapeHtml(c.description || '')}</p>
          <div class="mt-2 flex items-center justify-between">
            <div class="font-semibold">${escapeHtml(price)}</div>
            <div class="flex gap-2">
              <a class="orderBtn inline-flex items-center gap-2 px-3 py-1 rounded border text-sm" href="#" data-name="${encodeURIComponent(cakeName)}" data-price="${encodeURIComponent(c.price || '')}">
                ðŸ›’ Order
              </a>
              ${isAdmin ? `<button class="deleteBtn inline-flex items-center gap-2 px-3 py-1 rounded bg-red-500 text-white text-sm" data-id="${c.id}">Delete</button>` : ''}
            </div>
          </div>
        `;

        cakesGrid.appendChild(card);
      });

      // wire order buttons & delete
      document.querySelectorAll('.orderBtn').forEach(btn => {
        btn.addEventListener('click', (ev) => {
          ev.preventDefault();
          const name = decodeURIComponent(btn.dataset.name);
          const price = decodeURIComponent(btn.dataset.price) || '';
          openWhatsAppOrder(name, price);
        });
      });

      document.querySelectorAll('.deleteBtn').forEach(btn => {
        btn.addEventListener('click', async (ev) => {
          const id = btn.dataset.id;
          if(!confirm('Delete this cake?')) return;
          await deleteCake(id);
          await refreshCakes();
        });
      });
    }

    // Escape helper
    function escapeHtml(str){
      if(!str) return '';
      return String(str).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
    }

    // Open WhatsApp with message formatted
    function openWhatsAppOrder(name, price){
      const cakeName = name || 'cake';
      const rupee = price ? `â‚¹${price}` : '';
      const message = `Hello Bakes-Villa! Iâ€™d like to order the ${cakeName} cake (${rupee}).%0AMy name: ______%0ADelivery address: ______`;
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
      // use window.open so it works on mobile and desktop
      window.open(url, '_blank');
    }

    // Add cake (insert into Supabase)
    async function addCakeToSupabase({ name, description, price, imageData }){
      try {
        const tableName = TABLE_NAME;
        const payload = { name, description, price, imageData, createdAt: new Date().toISOString() };
        const { data, error } = await supabase.from(tableName).insert([payload]).select();
        if (error) {
          console.error('Insert error', error);
          throw error;
        }
        return data && data[0];
      } catch (err) {
        console.error('addCakeToSupabase error', err);
        throw err;
      }
    }

    // Delete cake
    async function deleteCake(id){
      try {
        const tableName = TABLE_NAME;
        if(!id) return;
        const { error } = await supabase.from(tableName).delete().eq('id', id);
        if (error) { console.error('Delete error', error); throw error; }
      } catch (err) {
        console.error('deleteCake error', err);
      }
    }

    // Refresh list
    async function refreshCakes(){
      const cakes = await fetchCakes();
      renderCakes(cakes);
      // update admin list too
      renderAdminList(cakes);
    }

    // Render admin list for convenience
    function renderAdminList(cakes){
      adminList.innerHTML = '';
      if(!cakes || cakes.length === 0) {
        adminList.innerHTML = '<div class="text-sm text-gray-500">No cakes yet</div>';
        return;
      }
      cakes.forEach(c => {
        const row = document.createElement('div');
        row.className = 'flex items-center justify-between bg-gray-50 p-2 rounded';
        row.innerHTML = `<div class="text-sm">${escapeHtml(c.name)} <div class="text-xs text-gray-500">â‚¹${escapeHtml(c.price||'')}</div></div>
                         <div class="flex gap-2">
                           <button data-id="${c.id}" class="delSmall px-2 py-1 text-xs bg-red-500 text-white rounded">Delete</button>
                         </div>`;
        adminList.appendChild(row);
      });
      document.querySelectorAll('.delSmall').forEach(b => {
        b.addEventListener('click', async () => {
          if(!confirm('Delete this cake?')) return;
          await deleteCake(b.dataset.id);
          await refreshCakes();
        });
      });
    }

    // Login handler
    login.addEventListener('submit', (e) => {
      e.preventDefault();
      const u = document.getElementById('loginUser').value.trim();
      const p = document.getElementById('loginPass').value;
      if(u === STAFF_USERNAME && p === STAFF_PASSWORD){
        setAdmin(true);
        loginMsg.classList.add('hidden');
        // show admin panel and update list
        refreshCakes();
      } else {
        loginMsg.textContent = 'Invalid credentials';
        loginMsg.classList.remove('hidden');
      }
    });

    // Add cake form handler
    addCakeForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if(!isAdmin) { alert('Please login as staff'); return; }
      const name = document.getElementById('cakeName').value.trim();
      const description = document.getElementById('cakeDesc').value.trim();
      const price = document.getElementById('cakePrice').value.trim();
      const imageData = document.getElementById('cakeImage').value.trim();
      if(!name || !price) { alert('Name and price required'); return; }
      try {
        adminMsg.textContent = 'Adding...';
        adminMsg.classList.remove('hidden');
        await addCakeToSupabase({ name, description, price, imageData });
        adminMsg.textContent = 'Added successfully';
        setTimeout(()=> adminMsg.classList.add('hidden'), 2000);
        addCakeForm.reset();
        await refreshCakes();
      } catch (err) {
        adminMsg.textContent = 'Error adding cake (check console)';
        console.error(err);
      }
    });

    // refresh button
    refreshBtn.addEventListener('click', refreshCakes);

    // Start: fetch and render cakes
    (async function init(){
      await refreshCakes();
    })();
  </script>

</body>
</html>



