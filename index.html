<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bakes-Villa - Artisan Cakes</title>
    
    <!-- FAVICON: Cupcake emoji favicon for browser tabs -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßÅ</text></svg>">
    
    <!-- Load Supabase SDK -->
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

        // NOTE: These keys are derived from user input and MUST be kept in the code for the Supabase logic to work.
        const SUPABASE_URL = 'https://pbdibajhxdvotlppvfmz.supabase.co';
        const SUPABASE_ANON_KEY = 
        
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Expose Supabase client globally
        window.supabaseClient = supabase;
        window.SUPABASE_TABLE_NAME = 'Bakes-Villa'; // Table name confirmed via user error history
        
        // Ensure the main script runs only after this module is loaded
        if (window.onloadCallback) {
            window.onloadCallback();
        }
    </script>

    <!-- Load Google Fonts: Playfair Display (for headings) and Inter (for body) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Configure Tailwind with the Sophisticated Cafe Mode color palette -->
    <script>
        // --- Color Palette Definitions (Based on User's Image) ---

        // Light Mode Colors
        const lightColors = {
            'bg-main': '#F5F5E0',        // Pale Cream (Main Background)
            'bg-surface': '#FFFFFF',     // Pure White (Card Background)
            'primary': '#956247',        // Warm Brown (Accent/Text)
            'secondary': '#A87C64',      // Soft Brown (Muted Text/Borders)
            'accent-warm': '#593A32',    // Dark Chocolate (Buttons/Strong Accent)
            'text-dark': '#3D271D',      // Deep Brown (Body Text)
        };
        
        // Dark Mode Colors (Inverted and adapted for contrast)
        const darkColors = {
            'bg-main': '#3D271D',        // Dark Chocolate (Page Background)
            'bg-surface': '#4D362C',     // Slightly Lighter Dark Chocolate (Card Background)
            'primary': '#F5F5E0',        // Pale Cream (Accent/Title)
            'secondary': '#D2B48C',      // Tan/Beige (Muted Text/Borders)
            'accent-warm': '#D2B48C',    // Tan/Beige (Warm Accent)
            'text-dark': '#F5F5E0',      // Pale Cream (Body Text)
        };

        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        heading: ['"Playfair Display"', 'serif'],
                        body: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        // Tailwind will use these custom properties defined in the <style> block
                        'bg-main': 'var(--color-bg-main)',
                        'bg-surface': 'var(--color-bg-surface)',
                        'primary': 'var(--color-primary)',
                        'secondary': 'var(--color-secondary)',
                        'accent-warm': 'var(--color-accent-warm)',
                        'text-dark': 'var(--color-text-dark)',
                    },
                    boxShadow: {
                        'glow': '0 0 15px var(--color-primary-shadow)',
                    }
                }
            }
        }
    </script>
    <style>
        /* CSS Variables based on Light/Dark Mode */
        :root {
            /* Light Mode Defaults */
            --color-bg-main: #F5F5E0;
            --color-bg-surface: #FFFFFF;
            --color-primary: #956247; 
            --color-secondary: #A87C64;
            --color-accent-warm: #593A32;
            --color-text-dark: #3D271D;
            --color-primary-shadow: rgba(149, 98, 71, 0.4); /* Warm Brown Shadow */
        }
        
        .dark {
            /* Dark Mode Overrides */
            --color-bg-main: #3D271D;
            --color-bg-surface: #4D362C;
            --color-primary: #F5F5E0;
            --color-secondary: #D2B48C;
            --color-accent-warm: #D2B48C;
            --color-text-dark: #F5F5E0;
            --color-primary-shadow: rgba(245, 245, 224, 0.4); /* Pale Cream Shadow */
        }
        
        /* Base Styles and Fonts */
        body {
            font-family: 'Inter', sans-serif; /* body font */
            background-color: var(--color-bg-main);
            color: var(--color-text-dark);
            scroll-behavior: smooth;
            transition: background-color 0.3s, color 0.3s;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Playfair Display', serif; /* heading font */
        }

        /* CARD STYLES - Soft, Layered Surface */
        .cake-card {
            background-color: var(--color-bg-surface); 
            transition: all 0.3s ease-in-out;
            border: 1px solid var(--color-secondary); 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            opacity: 0; 
            transform: translateY(20px); 
        }

        /* CARD HOVER EFFECT - Activate Glow */
        .cake-card:hover {
            box-shadow: var(--tw-shadow), var(--shadow-glow); 
            border-color: var(--color-primary); 
            transform: translateY(-5px) scale(1.02);
        }
        
        /* MODAL BACKDROP - Glassmorphism style */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(10px);
        }
        
        /* MODAL CONTENT SIZING FIXES */
        #modalContent, #editModalContent {
            max-width: 95vw; /* Allow modal to use more screen width on mobile */
            margin: 1rem; /* Add margin around the modal content */
        }
        
        /* MODAL IMAGE SIZING FIX - Make image scale down gracefully */
        .modal-image {
            width: 100%; /* Use full available width in modal */
            height: auto;
            max-height: 50vh; /* Limit vertical size to keep content visible */
            object-fit: contain; /* Use contain to ensure full image is visible, not cropped */
        }


        /* PRIMARY BUTTON STYLES - Deep Accent */
        .primary-button {
            background-color: var(--color-primary); 
            transition: all 0.2s ease-out; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            color: var(--color-bg-surface); 
        }
        .primary-button:hover {
            background-color: var(--color-secondary); 
            box-shadow: 0 0 15px var(--color-primary-shadow);
            transform: scale(1.02); 
        }
        .primary-button:active {
            transform: scale(0.98);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
        }
        
        /* ACCENT BUTTON STYLES - Warm Accent */
        .accent-button {
            background-color: var(--color-accent-warm); 
            color: white;
            transition: all 0.2s ease-out; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        }
        .accent-button:hover {
            background-color: #B58D6D; /* Slightly lighter rose taupe */
            box-shadow: 0 0 15px rgba(210, 180, 140, 0.7); /* Tan glow */
            transform: scale(1.02); 
        }
        .accent-button:active {
            transform: scale(0.98);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
        }

        /* FROSTED HEADER EFFECT */
        .frosted-header {
            /* Using solid dark brown in dark mode and solid white in light mode for the luxury header */
            background-color: var(--color-bg-surface); 
            backdrop-filter: blur(0); 
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); 
        }
        .dark .frosted-header {
            background-color: #3D271D; /* Solid Dark Chocolate for AMBAA GOLD look */
            border-bottom: 1px solid #956247; /* Subtle border */
        }
        
        /* Utility styles for forms and numbers (unchanged) */
        input[type="file"]::file-selector-button { display: none; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        /* Entry Animation Keyframes */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-entry {
            animation: slideIn 0.5s ease-out forwards;
        }
        /* Specific Admin Card Styles */
        .admin-card-actions {
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
        .cake-card:hover .admin-card-actions {
            opacity: 1;
        }
        
        /* MOBILE NAVIGATION FIXES */
        .mobile-menu-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 60; /* Above all modals except login */
            transform: translateX(-100%);
            transition: transform 0.3s ease-out;
            background-color: rgba(0, 0, 0, 0.5); /* Backdrop */
        }
        .mobile-menu-container.open {
            transform: translateX(0);
        }
        .mobile-menu {
            width: 75%; /* Use 3/4 screen width on mobile */
            max-width: 300px;
            height: 100%;
            background-color: var(--color-bg-surface);
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.2);
        }
        /* Header adjustment for small screens */
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }


    </style>
</head>
<body class="min-h-screen">

    <!-- Mobile Navigation Modal -->
    <div id="mobileMenuContainer" class="mobile-menu-container hidden" onclick="toggleMobileMenu(event)">
        <div id="mobileMenu" class="mobile-menu p-6" onclick="event.stopPropagation()">
            <div class="flex justify-end mb-8">
                <button onclick="toggleMobileMenu()" class="text-primary hover:text-accent-warm transition duration-150">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-8 h-8">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <nav class="space-y-6">
                <!-- Theme Toggle moved here -->
                <div class="flex items-center space-x-3 pb-4 border-b border-secondary/30">
                    <button id="themeToggle" onclick="toggleTheme(); toggleMobileMenu();" class="primary-button text-sm w-10 h-10 rounded-full font-bold flex items-center justify-center border border-primary/50">
                        D
                    </button>
                    <span class="text-text-dark font-semibold">Toggle Theme (L/D)</span>
                </div>

                <a href="#about-section" onclick="toggleMobileMenu();" class="block text-2xl font-heading font-semibold text-text-dark hover:text-primary transition duration-150">About</a>
                <a href="#gallery" onclick="toggleMobileMenu();" class="block text-2xl font-heading font-semibold text-text-dark hover:text-primary transition duration-150">Shop</a>
                <a href="tel:7543060400" onclick="toggleMobileMenu();" class="block text-2xl font-heading font-semibold text-text-dark hover:text-primary transition duration-150">Call to Enquire</a>
            </nav>
        </div>
    </div>

    <!-- Header Section -->
    <header class="frosted-header sticky top-0 z-20 border-b border-secondary/30 shadow-lg">
        <div class="max-w-7xl mx-auto py-4 px-6 sm:px-8 lg:px-10 header-content">
            
            <div class="flex items-center space-x-3">
                 <!-- Hamburger Menu Button -->
                <button onclick="toggleMobileMenu()" class="primary-button text-sm w-8 h-8 rounded-full font-bold flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                    </svg>
                </button>

                <h1 class="text-4xl font-heading font-extrabold text-primary tracking-wider uppercase drop-shadow-sm flex-shrink-0 sm:text-3xl lg:text-4xl">
                    Bakes-Villa
                </h1>
            </div>
            
            <div class="header-actions hidden sm:flex"> 
                
                <!-- Admin Controls Group -->
                <div id="adminControlsGroup" class="flex items-center space-x-2">
                    
                    <!-- Admin Toggle Button (Visible only when logged in) -->
                    <div id="adminPanelToggle" class="hidden">
                        <button onclick="toggleAdminPanel()" class="primary-button text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-2 rounded-full flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 mr-1">
                                <path fill-rule="evenodd" d="M10.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0Z" clip-rule="evenodd" />
                                <path d="M1.5 18.75c0-1.87 3.8-3.375 8.25-3.375s8.25 1.505 8.25 3.375M20.25 10.5a.75.75 0 0 1-.75.75H4.5a.75.75 0 0 1-.75-.75V8.25a.75.75 0 0 1 .75-.75h15a.75.75 0 0 1 .75.75v2.25Z" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            Admin
                        </button>
                    </div>

                    <!-- Logout Button -->
                    <div id="logoutButtonContainer" class="hidden">
                        <button onclick="handleLogout()" class="primary-button text-sm sm:text-base px-3 py-2 sm:px-4 sm:py-2 rounded-full flex items-center bg-red-600 hover:bg-red-700">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15M12 9l3 3m0 0-3 3m3-3H2.25" />
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Theme Toggle Button (Desktop only) -->
                    <button id="themeToggleDesktop" onclick="toggleTheme()" class="primary-button text-sm w-8 h-8 rounded-full font-bold flex items-center justify-center border border-primary/50">
                        D
                    </button>

                </div>

            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto pt-28 pb-16 px-6 sm:px-8 lg:px-10">
        
        <!-- Gourmet Hero/Headline Section -->
        <div class="text-center mb-16">
             <h2 class="text-5xl sm:text-6xl font-heading font-extrabold text-text-dark leading-tight mb-4">
                The Art of Gourmet Baking
            </h2>
            <p class="text-xl sm:text-2xl text-secondary mb-8 max-w-4xl mx-auto">
                Discover unparalleled craftsmanship in exquisite cakes and health-conscious pastries, perfected for discerning palates.
            </p>
             <a href="#gallery" class="primary-button text-white px-8 py-4 rounded-full font-heading font-semibold text-lg hover:bg-secondary transition duration-300">
                View Our Collection
            </a>
        </div>


        <!-- About Section Anchor -->
        <div id="about-section" class="mb-16 border-t border-b border-secondary/50 py-10">
            <h3 class="text-3xl font-heading font-bold text-primary mb-4 text-center">Founder's Note</h3>
            
            <div class="max-w-3xl mx-auto text-center">
                <p class="text-lg text-text-dark leading-relaxed mb-4 italic">
                    "Bakes-Villa was founded on the belief that a great cake should be an experience‚Äîa blend of artistry, premium ingredients, and health consciousness. We are committed to transforming simple baking into gourmet satisfaction."
                </p>
                <p class="text-xl font-heading font-semibold text-accent-warm mt-4">‚Äî Siddhi Jain, Founder</p>
            </div>
        </div>


        <!-- Admin Panel Form -->
        <div id="adminPanel" class="bg-bg-surface p-6 sm:p-8 rounded-xl shadow-lg border border-secondary/30 mb-16 hidden">
            <h3 class="text-3xl font-heading font-bold text-primary mb-6 border-b border-secondary/30 pb-3">
                Admin: Add New Cake
            </h3>
            <form id="addCakeForm" class="space-y-4">
                <input type="text" id="cakeName" placeholder="Cake Name (e.g., Rose Taupe Velvet)" required 
                       class="w-full p-3 rounded-lg border border-secondary bg-bg-main placeholder-secondary focus:ring-primary focus:border-primary text-text-dark">
                
                <textarea id="cakeDescription" placeholder="Description (e.g., A rich, dark-chocolate sponge with cream cheese frosting...)" required
                          class="w-full p-3 rounded-lg border border-secondary bg-bg-main placeholder-secondary focus:ring-primary focus:border-primary text-text-dark"></textarea>
                
                <input type="number" id="cakePrice" placeholder="Price (Numbers only, e.g., 950)" required min="0"
                       class="w-full p-3 rounded-lg border border-secondary bg-bg-main placeholder-secondary focus:ring-primary focus:border-primary text-text-dark">
                
                <div class="flex items-center space-x-4">
                    <label for="cakeImage" class="flex items-center primary-button px-4 py-2 rounded-full cursor-pointer text-sm">
                        <!-- Custom People Icon for file selection -->
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5 mr-2">
                            <path fill-rule="evenodd" d="M1.5 6a2.25 2.25 0 0 1 2.25-2.25h16.5A2.25 2.25 0 0 1 22.5 6v12a2.25 2.25 0 0 1-2.25 2.25H3.75A2.25 2.25 0 0 1 1.5 18V6ZM3.75 6.75c0-.621.504-1.125 1.125-1.125h16.5c.621 0 1.125.504 1.125 1.125v.75c0 .621-.504 1.125-1.125 1.125H4.875A1.125 1.125 0 0 1 3.75 7.5v-.75ZM7.5 10.5a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H8.25a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 0-1.5H8.25Z" clip-rule="evenodd" />
                        </svg>
                        Select Cake Photo
                    </label>
                    <input type="file" id="cakeImage" accept="image/*" required class="text-sm">
                </div>

                <div id="adminMessage" class="text-sm font-semibold text-center h-5"></div>
                
                <button type="submit" class="accent-button w-full py-3 rounded-full font-heading font-bold text-white text-lg mt-4">
                    Add Cake to Catalog
                </button>
            </form>
        </div>

        <!-- Cake Gallery Anchor -->
        <div id="gallery-anchor" class="mb-8">
            <h3 class="text-3xl font-heading font-bold text-primary mb-4">Shop Our Cakes</h3>
        </div>

        <!-- Cake Gallery -->
        <div id="gallery" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10">
            <!-- Cakes will be inserted here by JavaScript -->
            <p id="loadingMessage" class="col-span-full text-center text-secondary text-lg">Loading delicious creations...</p>
            <p id="errorMessage" class="col-span-full text-center text-red-500 font-bold hidden"></p>
        </div>
    </main>
    
    <!-- EDIT Modal Pop-up for Admin -->
    <div id="editModal" class="fixed inset-0 z-50 hidden items-center justify-center p-6 modal-backdrop" onclick="closeEditModal(event)">
        <div id="editModalContent" class="bg-bg-surface rounded-2xl shadow-2xl w-full max-w-xl overflow-hidden p-6 sm:p-8 transform transition-all scale-90 opacity-0 duration-300 border border-primary/50" onclick="event.stopPropagation()">
            <h3 class="text-3xl font-heading font-bold text-primary mb-6 border-b border-secondary/30 pb-3">
                Admin: Edit Cake
            </h3>
            <form id="editCakeForm" class="space-y-4">
                <input type="hidden" id="editCakeId">
                <input type="text" id="editCakeName" placeholder="Cake Name" required 
                       class="w-full p-3 rounded-lg border border-secondary bg-bg-main placeholder-secondary focus:ring-primary focus:border-primary text-text-dark">
                
                <textarea id="editCakeDescription" placeholder="Description" required
                          class="w-full p-3 rounded-lg border border-secondary bg-bg-main placeholder-secondary focus:ring-primary focus:border-primary text-text-dark"></textarea>
                
                <input type="number" id="editCakePrice" placeholder="Price (Numbers only)" required min="0"
                       class="w-full p-3 rounded-lg border border-secondary bg-bg-main placeholder-secondary focus:ring-primary focus:border-primary text-text-dark">
                
                <div id="editMessage" class="text-sm font-semibold text-center h-5"></div>
                
                <button type="submit" class="accent-button w-full py-3 rounded-full font-heading font-bold text-white text-lg mt-4">
                    Save Changes
                </button>
                <button type="button" onclick="closeEditModal()" class="primary-button w-full py-3 rounded-full font-heading font-bold text-lg mt-2">
                    Cancel
                </button>
            </form>
        </div>
    </div>


    <!-- READ-ONLY Modal Pop-up for Guest User -->
    <div id="cakeModal" class="fixed inset-0 z-50 hidden items-center justify-center p-6 modal-backdrop" onclick="closeModal(event)">
        <div id="modalContent" class="bg-bg-surface rounded-2xl shadow-2xl w-full max-w-xl overflow-hidden transform transition-all scale-90 opacity-0 duration-300 border border-secondary/50" onclick="event.stopPropagation()">
            
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-5 border-b border-secondary/30">
                <h3 id="modalTitle" class="text-3xl font-heading font-bold text-text-dark">Cake Name</h3>
                <button onclick="closeModal()" class="text-secondary hover:text-primary transition duration-150 transform hover:rotate-90">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-7 h-7">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                    </svg>                      
                </button>
            </div>

            <!-- Modal Body -->
            <div class="p-6 sm:p-8">
                <img id="modalImage" src="" alt="Selected Cake" class="w-full h-64 object-cover rounded-xl mb-6 shadow-md border border-secondary/50 modal-image">
                
                <div class="flex justify-between items-center mb-4">
                    <p class="text-2xl font-heading font-extrabold text-accent-warm" id="modalPrice">‚Çπ000</p>
                </div>
                <p id="modalDescription" class="text-secondary leading-relaxed text-lg mb-8">Cake description here.</p>

                <!-- WhatsApp Order Link -->
                <a id="whatsappOrderLink" href="#" target="_blank" class="w-full block text-center accent-button font-heading font-bold py-4 px-8 rounded-full shadow-xl text-lg">
                    WhatsApp Order
                </a>
            </div>
        </div>
    </div>
    
    <!-- Admin Login Modal (Hidden by default) -->
    <div id="adminLoginModal" class="fixed inset-0 z-50 hidden items-center justify-center p-6 modal-backdrop" onclick="closeLoginModal(event)">
        <div id="loginModalContent" class="bg-bg-surface rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden p-8 transform transition-all scale-90 opacity-0 duration-300 border border-primary/50" onclick="event.stopPropagation()">
            <h3 class="text-2xl font-heading font-bold text-primary mb-6 text-center">Admin Login (AL)</h3>
            <form id="adminLoginForm" class="space-y-4">
                <input type="text" id="adminUsername" placeholder="Username" required 
                       class="w-full p-3 rounded-lg border border-secondary bg-bg-main placeholder-secondary focus:ring-primary focus:border-primary text-text-dark">
                
                <input type="password" id="adminPassword" placeholder="Password" required
                       class="w-full p-3 rounded-lg border border-secondary bg-bg-main placeholder-secondary focus:ring-primary focus:border-primary text-text-dark">
                
                <div id="loginMessage" class="text-sm font-semibold text-center h-5 text-red-500"></div>
                
                <button type="submit" class="primary-button w-full py-3 rounded-full font-heading font-bold text-lg mt-4">
                    Login
                </button>
            </form>
        </div>
    </div>


    <!-- Footer Section -->
    <footer class="bg-bg-surface border-t border-secondary/30 py-5 text-center text-secondary text-sm">
        <p id="footerYear">
            <!-- Year placeholder will be filled by JS -->
        </p>
        <button onclick="openLoginModal()" class="text-primary hover:text-accent-warm transition duration-150 mt-1 focus:outline-none">
            Admin Login (AL)
        </button>
    </footer>

    <!-- JavaScript Application Logic -->
    <script>
        // --- Global Variables and Constants ---
        let isAdmin = false;
        let isDarkMode = false;
        
        // Admin credentials (client-side simulation)
        const ADMIN_USERNAME = 'siddhijain';
        const ADMIN_PASSWORD = 'siddhijain123';
        const ORDER_PHONE = '7543060400'; // UPDATED WHATSAPP NUMBER

        // Element references
        const galleryEl = document.getElementById('gallery');
        const loadingMessageEl = document.getElementById('loadingMessage');
        const errorMessageEl = document.getElementById('errorMessage');
        const footerYearEl = document.getElementById('footerYear');
        const themeToggleEl = document.getElementById('themeToggle');
        const mobileMenuContainerEl = document.getElementById('mobileMenuContainer');

        // Modals & Forms
        const cakeModalEl = document.getElementById('cakeModal');
        const modalContentEl = document.getElementById('modalContent');
        const modalTitleEl = document.getElementById('modalTitle');
        const modalImageEl = document.getElementById('modalImage');
        const modalDescriptionEl = document.getElementById('modalDescription');
        const modalPriceEl = document.getElementById('modalPrice');
        const whatsappOrderLinkEl = document.getElementById('whatsappOrderLink');
        
        const adminPanelToggleEl = document.getElementById('adminPanelToggle');
        const adminPanelEl = document.getElementById('adminPanel');
        const addCakeFormEl = document.getElementById('addCakeForm');
        const adminMessageEl = document.getElementById('adminMessage');

        const adminLoginModalEl = document.getElementById('adminLoginModal');
        const loginModalContentEl = document.getElementById('loginModalContent');
        const adminLoginFormEl = document.getElementById('adminLoginForm');
        const loginMessageEl = document.getElementById('loginMessage');
        const adminUsernameEl = document.getElementById('adminUsername');
        const adminPasswordEl = document.getElementById('adminPassword');
        
        const editModalEl = document.getElementById('editModal');
        const editModalContentEl = document.getElementById('editModalContent');
        const editCakeFormEl = document.getElementById('editCakeForm');
        const editCakeIdEl = document.getElementById('editCakeId');
        const editCakeNameEl = document.getElementById('editCakeName');
        const editCakeDescriptionEl = document.getElementById('editCakeDescription');
        const editCakePriceEl = document.getElementById('editCakePrice');
        const editMessageEl = document.getElementById('editMessage');

        let supabaseClient;
        let SUPABASE_TABLE_NAME;
        const SUPABASE_BUCKET_NAME = 'cake_photos'; // Hardcoded for upload consistency


        // --- Utility Functions ---

        /**
         * Renders a single cake card element.
         * @param {object} cake - The cake data object.
         * @param {number} index - Index for animation delay.
         * @returns {HTMLElement} The created card element.
         */
        function createCakeCard(cake, index) {
            const card = document.createElement('div');
            card.classList.add('cake-card', 'p-5', 'rounded-2xl', 'shadow-deep', 'cursor-pointer', 'lg:hover:shadow-glow', 'border-secondary/30', 'relative');
            card.style.animationDelay = ${index * 0.05}s;
            card.classList.add('animate-entry');
            
            // Determine the click action based on admin status
            card.onclick = () => {
                if (isAdmin) {
                    openEditModal(cake);
                } else {
                    openGuestModal(cake);
                }
            };

            // Using imageData, confirmed column name
            const safeImage = cake.imageData || 'https://placehold.co/300x300/6988A2/FFFFFF?text=Image+Missing';

            card.innerHTML = `
                <img src="${safeImage}" alt="${cake.name}" loading="lazy"
                     class="w-full h-56 object-cover rounded-xl mb-4 border border-secondary/20 transition-transform duration-300 ease-in-out">
                <div class="relative z-10">
                    <h3 class="text-2xl font-heading font-semibold text-text-dark mb-1 truncate">${cake.name}</h3>
                    <p class="text-accent-warm font-bold text-xl">‚Çπ${cake.price}</p>
                </div>
                
                <!-- Admin Delete Button -->
                <div class="admin-card-actions absolute top-7 right-7 ${isAdmin ? 'block' : 'hidden'}">
                    <button onclick="event.stopPropagation(); deleteCake('${cake.id}', '${cake.name}')" 
                            class="bg-red-600 hover:bg-red-700 text-white p-2 rounded-full shadow-lg transition duration-200"
                            title="Delete Cake">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m14.74 9-.346 9m-4.788 0L9.262 9m1.776-7.042a.25.25 0 0 1 .432 0l1.096 1.847c.394.664.912 1.252 1.547 1.76l2.164 1.758a.25.25 0 0 1 .094.483l-1.397.932a.75.75 0 0 0-.256.745l.235 1.176c.075.375-.24.735-.597.735H7.75c-.357 0-.672-.36-.597-.735l.235-1.176a.75.75 0 0 0-.256-.745l-1.397-.932a.25.25 0 0 1 .094-.483l2.164-1.758c.635-.508 1.153-1.096 1.547-1.76l1.096-1.847Z" />
                        </svg>
                    </button>
                </div>
            `;
            return card;
        }

        // --- Gallery and Modal Logic ---

        /**
         * Renders all cakes into the gallery area.
         * @param {Array<object>} cakes - Array of cake objects.
         */
        function renderGallery(cakes) {
            galleryEl.innerHTML = '';
            loadingMessageEl.classList.add('hidden');
            errorMessageEl.classList.add('hidden');

            if (cakes.length === 0) {
                galleryEl.innerHTML = <p class="col-span-full text-center text-secondary text-2xl mt-8">No cakes available yet. Check back soon!</p>;
                return;
            }

            // Sort by creation date (newest first)
            cakes.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            cakes.forEach((cake, index) => {
                galleryEl.appendChild(createCakeCard(cake, index));
            });
            
            // Re-show delete icons if admin panel is open after re-render
            if (isAdmin && !adminPanelEl.classList.contains('hidden')) {
                document.querySelectorAll('.admin-card-actions').forEach(el => el.classList.remove('hidden'));
            }
        }


        /**
         * Opens the read-only modal for non-admin users.
         */
        function openGuestModal(cake) {
            modalTitleEl.textContent = cake.name;
            // FIX: Using cake.imageData (confirmed column name)
            modalImageEl.src = cake.imageData || 'https://placehold.co/600x400/6988A2/FFFFFF?text=Image+Missing';
            modalImageEl.alt = cake.name;
            modalDescriptionEl.textContent = cake.description;
            modalPriceEl.textContent = ‚Çπ${cake.price};
            
            // Generate WhatsApp message (removed ID)
            const message = Hello, I would like to order the cake "${cake.name}" priced at ‚Çπ${cake.price}. Please let me know the process!;
            const encodedMessage = encodeURIComponent(message);
            const whatsappLink = https://wa.me/91${ORDER_PHONE}?text=${encodedMessage};
            whatsappOrderLinkEl.href = whatsappLink;

            // Show the modal
            cakeModalEl.classList.remove('hidden');
            cakeModalEl.classList.add('flex');
            document.body.classList.add('overflow-hidden');

            setTimeout(() => {
                modalContentEl.classList.remove('scale-90', 'opacity-0');
                modalContentEl.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        /**
         * Closes the guest detail modal.
         */
        window.closeModal = function(event) {
            if (event && event.target !== cakeModalEl && !event.target.closest('button')) {
                return; 
            }

            modalContentEl.classList.remove('scale-100', 'opacity-100');
            modalContentEl.classList.add('scale-90', 'opacity-0');

            setTimeout(() => {
                cakeModalEl.classList.remove('flex');
                cakeModalEl.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }, 300);
        }

        // --- Admin Edit/Delete Logic ---
        
        /**
         * Opens the Admin Edit modal and populates it with cake data.
         */
        function openEditModal(cake) {
            editCakeIdEl.value = cake.id;
            editCakeNameEl.value = cake.name;
            editCakeDescriptionEl.value = cake.description;
            editCakePriceEl.value = cake.price;
            editMessageEl.textContent = ''; // Clear previous message

            editModalEl.classList.remove('hidden');
            editModalEl.classList.add('flex');
            document.body.classList.add('overflow-hidden');

            setTimeout(() => {
                editModalContentEl.classList.remove('scale-90', 'opacity-0');
                editModalContentEl.classList.add('scale-100', 'opacity-100');
            }, 10);
        }
        
        /**
         * Closes the Admin Edit modal.
         */
        window.closeEditModal = function(event) {
             if (event && event.target !== editModalEl) {
                return; 
            }
            editModalContentEl.classList.remove('scale-100', 'opacity-100');
            editModalContentEl.classList.add('scale-90', 'opacity-0');

            setTimeout(() => {
                editModalEl.classList.remove('flex');
                editModalEl.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }, 300);
        }
        
        /**
         * Handles updating an existing cake record.
         */
        async function updateCake(event) {
            event.preventDefault();

            const id = editCakeIdEl.value;
            const name = editCakeNameEl.value.trim();
            const description = editCakeDescriptionEl.value.trim();
            const price = parseFloat(editCakePriceEl.value);

            if (isNaN(price) || price <= 0) {
                editMessageEl.textContent = "Price must be a valid number.";
                return;
            }
            
            editMessageEl.textContent = "Saving changes...";

            const { error } = await supabaseClient
                .from(SUPABASE_TABLE_NAME)
                .update({ 
                    name: name,
                    description: description,
                    price: price.toFixed(0),
                    // We do not update imageUrl here, assuming the image doesn't change during edit
                })
                .eq('id', id);

            if (error) {
                console.error("Update Error:", error);
                editMessageEl.textContent = Update failed: ${error.message};
            } else {
                editMessageEl.textContent = "Changes saved!";
                setTimeout(() => {
                    closeEditModal();
                    // Realtime will handle gallery update
                }, 500);
            }
        }
        
        /**
         * Handles deleting a cake record.
         */
        window.deleteCake = async function(id, name) {
            if (!isAdmin) return;
            
            // NOTE: Using window.confirm() here as it is an Admin action and a necessary final safety check.
            if (!window.confirm(Are you sure you want to delete "${name}"? This cannot be undone.")) {
                return;
            }
            
            // Delete the record from the database
            const { error: dbError } = await supabaseClient
                .from(SUPABASE_TABLE_NAME)
                .delete()
                .eq('id', id); 

            if (dbError) {
                console.error("Delete Database Error:", dbError);
                alert(Failed to delete cake record: ${dbError.message}); 
                return;
            }

            alert(Cake "${name}" deleted successfully.);
        }

        // --- Supabase Database Logic ---

        /**
         * Fetches all cake records from Supabase.
         */
        async function fetchCakes() {
            loadingMessageEl.classList.remove('hidden');
            errorMessageEl.classList.add('hidden');
            
            const { data, error } = await supabaseClient
                .from(SUPABASE_TABLE_NAME)
                .select('*')
                .order('createdAt', { ascending: false });

            loadingMessageEl.classList.add('hidden');
            
            if (error) {
                console.error("Supabase initial fetch error:", error);
                errorMessageEl.textContent = Error loading cakes. Check RLS READ policy.;
                errorMessageEl.classList.remove('hidden');
                galleryEl.innerHTML = '';
            } else {
                renderGallery(data || []);
            }
        }

        /**
         * Sets up the initial fetch and real-time listener for the cakes table.
         */
        function setupSupabaseListener() {
            if (typeof supabaseClient === 'undefined') {
                errorMessageEl.textContent = "FATAL ERROR: Supabase Client not initialized.";
                loadingMessageEl.classList.add('hidden');
                return;
            }

            // Realtime subscription for instant updates
            supabaseClient
                .channel(public:${SUPABASE_TABLE_NAME}) 
                .on('postgres_changes', 
                    { event: '*', schema: 'public', table: SUPABASE_TABLE_NAME }, 
                    () => fetchCakes()
                )
                .subscribe();

            fetchCakes();
        }


        /**
         * Handles submitting a new cake to the Supabase database and storage.
         */
        async function handleAddCake(event) {
            event.preventDefault();
            
            if (!isAdmin) {
                adminMessageEl.textContent = "Authentication required.";
                return;
            }

            adminMessageEl.textContent = "Processing and uploading file to storage...";
            
            const name = document.getElementById('cakeName').value.trim();
            const description = document.getElementById('cakeDescription').value.trim();
            const price = parseFloat(document.getElementById('cakePrice').value);
            const imageFile = document.getElementById('cakeImage').files[0];

            if (isNaN(price) || price <= 0 || !imageFile) {
                adminMessageEl.textContent = "Please fill all fields correctly.";
                return;
            }

            const now = new Date();
            // Force filename to end in .jpg and save to public folder for restrictive policy compliance
            const filePath = public/${name.replace(/\s+/g, '_').toLowerCase()}_${now.getTime()}.jpg;
            let publicUrl = '';
            
            // --- 1. UPLOAD IMAGE TO SUPABASE STORAGE ---
            const SUPABASE_BUCKET_NAME = 'cake_photos'; // Local constant definition
            const storageClient = supabaseClient.storage.from(SUPABASE_BUCKET_NAME);

            const { data: uploadData, error: uploadError } = await storageClient
                .upload(filePath, imageFile, {
                    cacheControl: '3600',
                    upsert: false
                });

            if (uploadError) {
                console.error("Storage Upload Error:", uploadError);
                // CRITICAL FIX: The error is here, indicating bucket name or policy issue.
                adminMessageEl.textContent = Storage upload failed. (Check Bucket Policy for INSERT by 'anon' role).;
                return;
            }

            // Get the public URL for the image
            const { data: publicUrlData } = storageClient.getPublicUrl(filePath);

            publicUrl = publicUrlData.publicUrl;


            // --- 2. INSERT RECORD TO POSTGRES TABLE ---
            adminMessageEl.textContent = "Saving record to database...";

            const { error: insertError } = await supabaseClient
                .from(SUPABASE_TABLE_NAME)
                .insert([{ 
                    name: name,
                    description: description,
                    price: price.toFixed(0), // Save as string without decimals
                    imageData: publicUrl, // FIX: Use 'imageData' as the column name
                    createdAt: now.toISOString() 
                }], {
                    // Critical RLS hint to bypass composite indexing limitations
                    hints: ['SKIP INDEX name', 'SKIP INDEX description'] 
                })
                .select(); 

            if (insertError) {
                console.error("Database Insert Error:", insertError);
                adminMessageEl.textContent = Record insert failed: ${insertError.message};
            } else {
                adminMessageEl.textContent = "Cake added successfully!";
                addCakeFormEl.reset();
                setTimeout(() => adminMessageEl.textContent = '', 3000);
            }
        }


        // --- Admin/Auth Logic ---

        /**
         * Opens the Admin Login modal.
         */
        window.openLoginModal = function() {
            if (isAdmin) {
                toggleAdminPanel(); // If already logged in, toggle the panel directly
                return;
            }
            adminLoginModalEl.classList.remove('hidden');
            adminLoginModalEl.classList.add('flex');
            loginModalContentEl.classList.remove('scale-90', 'opacity-0');
            loginModalContentEl.classList.add('scale-100', 'opacity-100');
            loginMessageEl.textContent = '';
            adminUsernameEl.focus();
        };

        /**
         * Closes the Admin Login modal.
         */
        window.closeLoginModal = function(event) {
            if (event && event.target !== adminLoginModalEl) {
                return; 
            }
            loginModalContentEl.classList.remove('scale-100', 'opacity-100');
            loginModalContentEl.classList.add('scale-90', 'opacity-0');

            setTimeout(() => {
                adminLoginModalEl.classList.remove('flex');
                adminLoginModalEl.classList.add('hidden');
            }, 300);
        };
        
        /**
         * Handles client-side logout.
         */
        window.handleLogout = function() {
            if (confirm("Are you sure you want to log out?")) {
                isAdmin = false;
                adminPanelEl.classList.add('hidden'); // Hide form
                adminPanelToggleEl.classList.add('hidden'); // Hide Admin button
                document.getElementById('logoutButtonContainer').classList.add('hidden'); // Hide Logout button
                
                // Force gallery re-render to hide delete/edit icons
                fetchCakes(); 
            }
        }


        /**
         * Handles the client-side Admin Login attempt.
         */
        function handleAdminLogin(event) {
            event.preventDefault();
            
            const username = adminUsernameEl.value.trim();
            const password = adminPasswordEl.value.trim();

            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                isAdmin = true;
                loginMessageEl.textContent = "Success! Access granted.";
                loginMessageEl.classList.remove('text-red-500');
                loginMessageEl.classList.add('text-green-500');

                // FINAL ROBUST FIX: Force state change and panel display
                
                // 1. Hide the modal contents immediately (for visual feedback)
                loginModalContentEl.classList.remove('scale-100', 'opacity-100');
                loginModalContentEl.classList.add('scale-90', 'opacity-0');
                
                // 2. Wait for the animation to finish, then hide the modal wrapper and show the panel
                setTimeout(() => {
                    adminLoginModalEl.classList.remove('flex');
                    adminLoginModalEl.classList.add('hidden');
                    
                    // Show Admin UI elements
                    adminPanelToggleEl.classList.remove('hidden');
                    document.getElementById('logoutButtonContainer').classList.remove('hidden');
                    adminPanelEl.classList.remove('hidden'); // Show add form immediately

                    // Force a re-render to show delete icons on cards
                    fetchCakes(); 
                }, 300); 

            } else {
                loginMessageEl.textContent = "Invalid credentials.";
                loginMessageEl.classList.remove('text-green-500');
                loginMessageEl.classList.add('text-red-500');
            }
        }

        /**
         * Toggles visibility of the main Admin Panel form.
         */
        window.toggleAdminPanel = function() {
            if (isAdmin) {
                const isHidden = adminPanelEl.classList.toggle('hidden');
                // When showing the panel, refetch cakes to ensure icons appear
                if (!isHidden) {
                    fetchCakes(); 
                }
            } else {
                openLoginModal();
            }
        };
        
        // Add event listener for the edit form submission
        editCakeFormEl.addEventListener('submit', updateCake);


        // --- Mobile Menu Logic ---
        window.toggleMobileMenu = function(event) {
            if (event && event.target === mobileMenuContainerEl && mobileMenuContainerEl.classList.contains('open')) {
                // Allows closing by clicking the dark backdrop area
                mobileMenuContainerEl.classList.remove('open');
                setTimeout(() => mobileMenuContainerEl.classList.add('hidden'), 300);
                return;
            }

            if (mobileMenuContainerEl.classList.contains('open')) {
                mobileMenuContainerEl.classList.remove('open');
                setTimeout(() => mobileMenuContainerEl.classList.add('hidden'), 300);
            } else {
                mobileMenuContainerEl.classList.remove('hidden');
                setTimeout(() => mobileMenuContainerEl.classList.add('open'), 10);
            }
        }


        // --- Theme Logic ---

        /**
         * Sets the theme based on localStorage or system preference.
         */
        function initializeTheme() {
            const storedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (storedTheme === 'dark' || (!storedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
                isDarkMode = true;
                themeToggleEl.textContent = 'L';
            } else {
                document.documentElement.classList.remove('dark');
                isDarkMode = false;
                themeToggleEl.textContent = 'D';
            }
        }

        /**
         * Toggles between dark and light themes manually.
         */
        window.toggleTheme = function() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
                isDarkMode = false;
                themeToggleEl.textContent = 'D';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
                isDarkMode = true;
                themeToggleEl.textContent = 'L';
            }
        }

        // --- Initialization ---

        /**
         * Runs application initialization after modules are loaded.
         */
        window.onloadCallback = function() {
            // Check for Supabase client availability
            if (typeof window.supabaseClient === 'undefined') {
                errorMessageEl.textContent = "FATAL ERROR: Supabase service initialization failed. Please check network connection.";
                errorMessageEl.classList.remove('hidden');
                return;
            }

            supabaseClient = window.supabaseClient;
            SUPABASE_TABLE_NAME = window.SUPABASE_TABLE_NAME;
            
            // 1. Initialize Theme
            initializeTheme();

            // 2. Setup Database Listener (Fetch data and establish Realtime)
            setupSupabaseListener();

            // 3. Set up Admin Login listener
            adminLoginFormEl.addEventListener('submit', handleAdminLogin);
            
            // 4. Set up Add Cake form listener
            addCakeFormEl.addEventListener('submit', handleAddCake);

            // 5. Update Footer Year
            footerYearEl.textContent = ¬© ${new Date().getFullYear()} Bakes-Villa. All rights reserved.;
        };
    </script>
</body>
</html>

